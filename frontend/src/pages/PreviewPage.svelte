<script>
  import { activeUserId } from '../lib/stores.js'

  function openInstructions() {
    if (!$activeUserId) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è')
      return
    }
    
    const url = `/instructions.html?userId=${$activeUserId}`
    window.open(url, '_blank')
  }

  function copyLink() {
    if (!$activeUserId) {
      alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è')
      return
    }
    
    const url = `${window.location.origin}/instructions.html?userId=${$activeUserId}`
    navigator.clipboard.writeText(url).then(() => {
      alert('–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!')
    })
  }
</script>

<div class="preview-page">
  <div class="card">
    <div class="card-header">
      <h2 class="card-title">üìã –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –ø—Ä–∏—ë–º—É –ª–µ–∫–∞—Ä—Å—Ç–≤</h2>
    </div>

    {#if !$activeUserId}
      <div class="empty-state">
        <div class="empty-state-icon">üë§</div>
        <div class="empty-state-text">–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è</div>
        <p style="color: var(--text-light);">
          –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏" –∏ –≤—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        </p>
      </div>
    {:else}
      <div class="preview-description">
        <p>
          –ü–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –ø—Ä–∏—ë–º—É –≤—Å–µ—Ö –ª–µ–∫–∞—Ä—Å—Ç–≤ –ø–∞—Ü–∏–µ–Ω—Ç–∞ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ.
          –≠—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç:
        </p>
        <ul>
          <li>‚úì –í—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ –ª–µ–∫–∞—Ä—Å—Ç–≤–∞</li>
          <li>‚úì –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–∏—ë–º–∞ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ</li>
          <li>‚úì –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ü–∏–∫–ª–∞—Ö</li>
          <li>‚úì –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å (—Å–µ–≥–æ–¥–Ω—è –ø—Ä–∏–Ω–∏–º–∞—Ç—å –∏–ª–∏ –ø–µ—Ä–µ—Ä—ã–≤)</li>
        </ul>
        <p>
          –í—ã –º–æ–∂–µ—Ç–µ –æ—Ç–∫—Ä—ã—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é, —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–∞—Ü–∏–µ–Ω—Ç—É –∏–ª–∏ —Ä–∞—Å–ø–µ—á–∞—Ç–∞—Ç—å.
        </p>
      </div>

      <div class="preview-actions">
        <button class="btn btn-primary btn-large" onclick={openInstructions}>
          üìÑ –û—Ç–∫—Ä—ã—Ç—å –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é
        </button>
        <button class="btn btn-secondary btn-large" onclick={copyLink}>
          üîó –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É
        </button>
      </div>

      <div class="preview-hint">
        <div class="hint-icon">üí°</div>
        <div class="hint-content">
          <strong>–°–æ–≤–µ—Ç:</strong> –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Å—Å—ã–ª–∫—É –∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –ø–∞—Ü–∏–µ–Ω—Ç—É —á–µ—Ä–µ–∑ WhatsApp, 
          —á—Ç–æ–±—ã –æ–Ω –≤—Å–µ–≥–¥–∞ –º–æ–≥ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–≤–æ—é –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –ø–æ –ø—Ä–∏—ë–º—É –ª–µ–∫–∞—Ä—Å—Ç–≤.
        </div>
      </div>
    {/if}
  </div>
</div>

<style>
  .preview-page {
    max-width: 800px;
    margin: 0 auto;
  }

  .preview-description {
    background: #f8f9fa;
    padding: 1.5rem;
    border-radius: 0.5rem;
    margin-bottom: 2rem;
    line-height: 1.8;
  }

  .preview-description ul {
    margin: 1rem 0;
    padding-left: 1.5rem;
  }

  .preview-description li {
    margin: 0.5rem 0;
    font-size: 1.05rem;
  }

  .preview-actions {
    display: flex;
    gap: 1rem;
    margin-bottom: 2rem;
  }

  .btn-large {
    flex: 1;
    padding: 1rem 1.5rem;
    font-size: 1.1rem;
    font-weight: 600;
  }

  .preview-hint {
    background: linear-gradient(135deg, #fff7ed 0%, #ffedd5 100%);
    border-left: 4px solid var(--warning);
    padding: 1rem;
    border-radius: 0.5rem;
    display: flex;
    gap: 1rem;
    align-items: start;
  }

  .hint-icon {
    font-size: 2rem;
    flex-shrink: 0;
  }

  .hint-content {
    flex: 1;
    line-height: 1.6;
  }

  @media (max-width: 768px) {
    .preview-actions {
      flex-direction: column;
    }

    .btn-large {
      width: 100%;
    }
  }

  @media (max-width: 480px) {
    .preview-description {
      padding: 1rem;
      font-size: 0.95rem;
    }

    .preview-description li {
      font-size: 0.95rem;
    }

    .btn-large {
      font-size: 1rem;
      padding: 0.875rem 1.25rem;
    }

    .hint-icon {
      font-size: 1.5rem;
    }

    .hint-content {
      font-size: 0.9rem;
    }
  }
</style>
